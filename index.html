<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three.js GLB Model</title>
    <style>
        /* ... (стили остаются без изменений) */
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
</head>
<body>
    <div class="overlay-text">ПРОДАЮ ПЛАКАТЫ</div>

    <script>
        // ... (сцена, камера, рендерер, освещение, controls - без изменений)

        let mixer1, mixer2, mixer3;
        let model1, model2, model3;

        function scaleModel(model, scaleFactor) {
            model.scale.set(scaleFactor, scaleFactor, scaleFactor);
        }

        const loader = new THREE.GLTFLoader();

        // Функция для создания и присвоения материала (ОСТАВЛЯЕМ БЕЗ ИЗМЕНЕНИЙ)
        function applyMaterial(model) {
            const material = new THREE.MeshStandardMaterial({
                color: 0xffffff,
                roughness: 0.0,
                metalness: 1.0,
            });

            model.traverse((child) => {
                if (child.isMesh) {
                    child.material = material;
                }
            });
        }

        // Загрузка первой модели (ИСПРАВЛЕННЫЙ БЛОК)
        loader.load('./models/untitled.glb', function(glb) {
            model1 = glb.scene;
            mixer1 = new THREE.AnimationMixer(model1);
            glb.animations.forEach((clip) => {
                let action = mixer1.clipAction(clip);
                action.play();
                action.timeScale = 0.3;
            });
            model1.position.set(0.2, 0, 0);
            scaleModel(model1, 2.3);

            // ЗАДЕРЖКА ПРИМЕНЕНИЯ МАТЕРИАЛА (САМОЕ ГЛАВНОЕ ИЗМЕНЕНИЕ)
            setTimeout(() => { 
                applyMaterial(model1);
            }, 0); // Задержка в 0 миллисекунд, но ставит выполнение в очередь

            scene.add(model1);
        });

        // Загрузка второй модели (АНАЛОГИЧНО ПЕРВОЙ)
        loader.load('./models/untitled2.glb', function(glb) {
            model2 = glb.scene;
            mixer2 = new THREE.AnimationMixer(model2);
            glb.animations.forEach((clip) => { /* ... */ });
            model2.position.set(-3, 0, 0);
            scaleModel(model2, 1);

            setTimeout(() => {
                applyMaterial(model2);
            }, 0);

            scene.add(model2);
        });

        // Загрузка третьей модели (АНАЛОГИЧНО ПЕРВОЙ)
        loader.load('./models/untitled3.glb', function(glb) {
            model3 = glb.scene;
            mixer3 = new THREE.AnimationMixer(model3);
            glb.animations.forEach((clip) => { /* ... */ });
            model3.position.set(3, 0, 0);
            scaleModel(model3, 1);

            setTimeout(() => {
                applyMaterial(model3);
            }, 0);

            scene.add(model3);
        });

        // ... (animate() - без изменений)
    </script>
</body>
</html>
